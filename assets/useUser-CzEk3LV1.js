import{c as e}from"./index-LR6X8NeB.js";import{d as t,p as n}from"./alerts-C3RXIXtm.js";import{t as r}from"./react-BcTN3v1I.js";var i=`ekomart_cart_`;function a(e){return e?`${i}${e}`:null}function o(e){let t=a(e);if(!t)return[];try{let e=localStorage.getItem(t);if(!e)return[];let n=JSON.parse(e);return Array.isArray(n)?n:[]}catch{return[]}}function s(e,t){let n=a(e);if(n)try{localStorage.setItem(n,JSON.stringify(t))}catch{}}const c=r((e,t)=>({currentUserId:null,items:[],setCurrentUser:t=>{let n=o(t??null);e({currentUserId:t??null,items:n})},addItem:(n,r=1)=>{if(!t().currentUserId)return;let{id:i,title:a,price:o,image:c,category:l,stock:u}=n,d=Math.min(Math.max(1,Math.floor(r)),Math.max(1,u));e(e=>{let t=e.items.find(e=>e.id===i),n;return n=t?e.items.map(e=>e.id===i?{...e,qty:Math.min(e.qty+d,e.stock)}:e):[...e.items,{id:i,qty:d,title:a,price:o,image:c,category:l,stock:u}],s(e.currentUserId,n),{items:n}})},removeItem:n=>{t().currentUserId&&e(e=>{let t=e.items.filter(e=>e.id!==n);return s(e.currentUserId,t),{items:t}})},setQuantity:(n,r)=>{if(!t().currentUserId)return;let i=Math.floor(Number(r));if(i<1){t().removeItem(n);return}e(e=>{let t=e.items.map(e=>{if(e.id!==n)return e;let t=Math.min(i,e.stock);return{...e,qty:t}});return s(e.currentUserId,t),{items:t}})},incrementQuantity:n=>{t().currentUserId&&e(e=>{let t=e.items.map(e=>{if(e.id!==n)return e;let t=Math.min(e.qty+1,e.stock);return{...e,qty:t}});return s(e.currentUserId,t),{items:t}})},decrementQuantity:n=>{t().currentUserId&&e(e=>{let t=e.items.map(e=>{if(e.id!==n)return e;let t=e.qty-1;return{...e,qty:t}}).filter(e=>e.qty>0);return s(e.currentUserId,t),{items:t}})},clearCart:()=>{let n=t().currentUserId;e({items:[]}),n&&s(n,[])}})),l=e=>e.items.reduce((e,t)=>e+t.qty,0),u=e=>e.items.reduce((e,t)=>e+t.price*t.qty,0);function d(e){return new Intl.NumberFormat(`en-US`,{style:`currency`,currency:`USD`,minimumFractionDigits:2,maximumFractionDigits:2}).format(Number(e))}var f=e();function p(){let[e,r]=(0,f.useState)(null);return(0,f.useEffect)(()=>{let e=n(t,e=>{r(e)});return()=>e()},[]),e}export{c as a,u as i,d as n,l as r,p as t};